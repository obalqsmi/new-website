!function(){const scope={settings:window.themeVariables.settings},settings={saleType:scope.settings.saleType,cartType:window.themeVariables.settings.cartType,moneyFormat:window.themeVariables.settings.moneyFormat},selectors={addonSection:".dbtfy-upsell-bundles",addonContainer:".dbtfy-upsell-bundles-container",productSection:".product.section",imageWrapper:".dbtfy-upsell-bundles__image-wrapper",image:".dbtfy-upsell-bundles__image",formWrapper:".dbtfy-upsell-bundles__form-wrapper",currentImage:".dbtfy-upsell-bundles__image-wrapper--current",currentForm:".dbtfy-upsell-bundles__form-wrapper--current",selectedForm:".dbtfy-upsell-bundles__form--active",imagesWrapper:".dbtfy-upsell-bundles__images-wrapper",formsWrapper:".dbtfy-upsell-bundles__forms-wrapper",checkbox:".dbtfy-upsell-bundles__checkbox",button:".dbtfy-upsell-bundles__button",select:".dbtfy-upsell-bundles__select",totalPrice:".dbtfy-upsell-bundles__price--total",comparePrice:".dbtfy-upsell-bundles__price--compare",itemPrice:".dbtfy-upsell-bundles__item-price--current",itemComparePrice:".dbtfy-upsell-bundles__item-price--compare",discountSaved:".dbtfy-upsell-bundles__discount-saved",discountSavedText:".dbtfy-upsell-bundles__discount-saved-text"},classes={enabledAddon:"dbtfy-upsell-bundles-enabled",hasSpecific:"dbtfy-upsell-bundles--has-specific",selectedImageWrapper:"dbtfy-upsell-bundles__image-wrapper--selected",selectedForm:"dbtfy-upsell-bundles__form--active"},section=(document.body.classList.add(classes.enabledAddon),document.querySelector(selectors.addonSection));if(section){theme.helpers.loadComponents(["imagesLazyloading","syncVariantImage","loadingState","discountCode","goToCheckout","ajaxCart","notificationToast"],()=>{init()}),document.addEventListener("shopify:section:load",e=>{theme.helpers.loadComponents(["imagesLazyloading","syncVariantImage","loadingState","discountCode","goToCheckout","ajaxCart","notificationToast"],()=>{init()}),sessionStorage.removeItem("upsellBundles")});const upsellBundleStorage={getAll:function(){var e=JSON.parse(sessionStorage.getItem("upsellBundles"));return e||[]},get:function(t){var e=JSON.parse(sessionStorage.getItem("upsellBundles"));return e?e.find(e=>e.productId===+t):null},add:function(e){var t=this.getAll()||[];t.push(e),sessionStorage.setItem("upsellBundles",JSON.stringify(t))},has:function(t){var e=this.getAll();return!!e&&e.some(e=>e.productId===+t)},remove:function(t){var e=this.getAll();if(e)return(e=e.filter(e=>e.productId!==t)).length?sessionStorage.setItem("upsellBundles",JSON.stringify(e)):sessionStorage.removeItem("upsellBundles"),!0}};function init(){Shopify.designMode&&1<document.querySelectorAll(selectors.addonSection).length&&(e=document.querySelector(selectors.productSection+" "+selectors.addonSection))&&e.remove();var e=theme.helpers.safelyParseJson(section.dataset.sectionSettings);e&&(settings.sectionId=e.sectionId,settings.productId=e.productId,settings.position=e.position,settings.limit=e.limit,settings.discountName=e.discountName,settings.discountAmount=e.discountAmount,settings.discountType=e.discountType,settings.recommendationsUrl=`/recommendations/products?&section_id=${settings.sectionId}&product_id=${settings.productId}&limit=`+settings.limit,(section.classList.contains(classes.hasSpecific)?upsellBundleLoaded:getRecommendationsSection)())}function getRecommendationsSection(){const r=theme.helpers.safelyParseJson(section.dataset.sectionTranslations);fetch(settings.recommendationsUrl).then(e=>e.text()).then(e=>{var e=(new DOMParser).parseFromString(e,"text/html").querySelector(selectors.addonSection),t=e.querySelector(".section-heading"),s=e.querySelector(".upsell-total-price"),n=e.querySelector(".dbtfy-upsell-bundles__button span"),o=e.querySelector(".current-product-label strong"),t=(t&&r&&(t.innerText=r.heading),o&&r&&(o.innerText=r.currentProductLabel),s&&r&&(s.innerText=r.totalPriceLabel),n&&r&&(n.innerText=r.buttonLabel),e.innerHTML);t&&""!==t.trim()&&(section.innerHTML=t,theme.imagesLazyLoading(),upsellBundleLoaded())})}function upsellBundleLoaded(){const currentImageUpsell=document.querySelector(selectors.currentImage);if(currentImageUpsell){const currentFormUpsell=section.querySelector(selectors.currentForm),imageWrapperBox=section.querySelector(selectors.imagesWrapper),formWrapperBox=section.querySelector(selectors.formsWrapper),listCheckboxes=section.querySelectorAll(selectors.checkbox),productMasterSelect=document.querySelector("[data-product-master-select]"),selects=section.querySelectorAll(selectors.select),button=section.querySelector(selectors.button);imageWrapperBox.insertAdjacentElement("afterbegin",currentImageUpsell),formWrapperBox.insertAdjacentElement("afterbegin",currentFormUpsell),"product_section"===settings.position&&addUpsellToProductSection(),listCheckboxes.forEach(o=>{o.addEventListener("click",e=>{var t=o.value,s=o.dataset.index,n=document.querySelector(selectors.imageWrapper+`[data-product-id='${t}'][data-index='${s}']`),t=document.querySelector(selectors.formWrapper+`[data-product-id='${t}'][data-index='${s}']`);n&&n.classList.toggle(classes.selectedImageWrapper),t&&t.classList.toggle(classes.selectedForm),verifyUnchecked(),checkPrice()})}),selects.forEach(i=>{i.addEventListener("change",e=>{var t,s,n,o,r,c=i.options[i.selectedIndex],c=theme.helpers.safelyParseJson(c.dataset.variantSettings);c&&(t=i.value,s=i.dataset.index,s=(t=section.querySelector(selectors.image+`[data-variant-id='${t}'][data-index='${s}']`)).closest(selectors.imageWrapper).querySelectorAll(selectors.image),n=i.nextElementSibling.querySelector(selectors.itemPrice),o=i.nextElementSibling.querySelector(selectors.itemComparePrice),r=c.price,c=c.comparePrice,s.forEach(e=>{e.setAttribute("hidden","hidden")}),t&&t.removeAttribute("hidden"),c<r?(n.classList.remove("text-sale"),o&&o.setAttribute("hidden","hidden")):(n.classList.add("text-sale"),o&&o.removeAttribute("hidden")),n&&(n.innerHTML=`<span class="money">${theme.Currency.formatMoney(r,settings.moneyFormat)}</span>`),o&&(o.innerHTML=`<span class="money">${theme.Currency.formatMoney(c,settings.moneyFormat)}</span>`),checkPrice(),i.closest(selectors.currentForm))&&theme.SyncProductVariant(i)})}),productMasterSelect?.addEventListener("change",e=>{var t=currentFormUpsell.querySelector(selectors.select);t.querySelector(`option[value="${productMasterSelect.value}"]`)&&t.value!==productMasterSelect.value&&(t.value=productMasterSelect.value,t.dispatchEvent(new Event("change")))}),checkPrice(),button.addEventListener("click",e=>{const forms=section.querySelectorAll(selectors.selectedForm),boxWithErrors=section.querySelector(".errors"),items=(boxWithErrors&&boxWithErrors.remove(),[]);forms.forEach(e=>{var t=e.closest(selectors.formWrapper).querySelector(selectors.checkbox);const s=+e.querySelector(selectors.select).value;t.checked&&((e=items.find(e=>e.id===s))?e.quantity++:items.push({id:s,quantity:1}))}),theme.loadingState.init(button),theme.ShopifyAPI.addItemFromForm({items:items,forms:forms},e=>{var t;isDiscountApplicable()&&(t=getVariantIds(),t={productId:settings.productId,variantIds:t,discount:{name:settings.discountName,type:settings.discountType,amount:settings.discountAmount}},upsellBundleStorage.remove(settings.productId),upsellBundleStorage.add(t),settings.discountName)&&settings.discountType&&settings.discountAmount&&(theme.discountCode.addDiscount(settings.discountName,settings.discountType,settings.discountAmount),theme.discountCode.init()),document.body.classList.contains("dbtfy-skip-cart-enabled")?theme.goToCheckoutWithDiscount():"drawer"===settings.cartType||"modal"===settings.cartType?(document.body.classList.contains("dbtfy-cart-notification-enabled")&&(window.initNotificationToast=!0),theme.ajaxCart.update(),document.addEventListener("theme:cart:loaded",e=>{theme.loadingState.destroy(button)})):document.body.classList.contains("dbtfy-cart-notification-enabled")?(theme.ajaxCart.update(),document.addEventListener("theme:cart:loaded",e=>{theme.loadingState.destroy(button)}),theme.NotificationToast.init(".dbtfy-cart-notification")):window.location.assign("/cart")},(XMLHttpRequest,textStatus,form)=>{const data=eval(`(${XMLHttpRequest.responseText})`);theme.loadingState.destroy(button),data.message&&422===data.status&&button.insertAdjacentHTML("afterend",`<div class="errors product-quantity-error">${data.description}</div>`)})}),document.addEventListener("theme:cart:loaded",e=>{upsellBundleDiscountOnCartUpdate(e.detail.cart)})}else section.style="display: none !important"}function upsellBundleDiscountOnCartUpdate(n){upsellBundleStorage.getAll().forEach(e=>{var t=e.discount,e=e.variantIds.reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{});Object.entries(e).every(([t,s])=>n.items.some(e=>e.variant_id===+t&&e.quantity>=s))?theme.discountCode.hasDiscount(t.name)||theme.discountCode.addDiscount(t.name,t.type,t.amount):theme.discountCode.removeDiscount(t.name)}),theme.discountCode.init(),theme.showTheMostValuableDiscountInCart()}function getVariantIds(){var e=section.querySelectorAll(selectors.select);return Array.from(e).map(e=>+e.value)}function isDiscountApplicable(){var e=section.querySelectorAll(selectors.checkbox),t=section.hasAttribute("data-discount-applied");let s=!1;var n=Array.from(e).reduce((e,t)=>t.checked?e+1:e,0);return s=n===e.length&&t?!0:s}function addUpsellToProductSection(){var e=document.querySelector(selectors.addonContainer);e&&(e.insertAdjacentElement("afterbegin",section),e.removeAttribute("hidden"))}function verifyUnchecked(){var e,t=section.querySelector(selectors.button),s=section.querySelectorAll(selectors.checkbox);t&&(e=Array.from(s).filter(e=>!e.checked),s.length===e.length?(t.classList.add("disabled"),t.setAttribute("disabled","disabled")):(t.classList.remove("disabled"),t.removeAttribute("disabled")))}function checkPrice(){var e=section.querySelectorAll(selectors.select),t=section.querySelector(selectors.totalPrice),s=section.querySelector(selectors.comparePrice),n=section.querySelectorAll(selectors.checkbox).length;let o=0,r=0,c=0;if(e.forEach(e=>{var t=e.closest(selectors.formWrapper)?.querySelector(selectors.checkbox);t&&t.checked&&(t=e.options[e.selectedIndex],e=theme.helpers.safelyParseJson(t.dataset.variantSettings))&&(t=e.price,e=e.comparePrice,c++,o+=t,r+=0<e?e:t)}),n===c&&settings.discountName&&settings.discountAmount&&settings.discountType){e=o;switch(settings.discountType){case"%":o-=o/100*settings.discountAmount;break;case"$":o-=100*settings.discountAmount}0<o?(r=e,section.setAttribute("data-discount-applied","true")):(o=e,section.removeAttribute("data-discount-applied"))}t.dataset.total=o,t.innerHTML=`<span class="money">${theme.Currency.formatMoney(o,settings.moneyFormat)}</span>`,o<r?(s.dataset.total=r,s.innerHTML=`<span class="money">${theme.Currency.formatMoney(r,settings.moneyFormat)}</span>`,s.removeAttribute("hidden")):s.setAttribute("hidden","hidden"),calculateDiscount(t,o,s,r),document.dispatchEvent(new CustomEvent("theme:addon:custom-currencies:convert-prices"))}function calculateDiscount(e,t,s,n){let o=null;var r,c=section.querySelector(selectors.discountSaved),i=section.querySelector(selectors.discountSavedText);c&&c.setAttribute("hidden","hidden"),e.classList.remove("text-sale"),t<n&&("percentage"===settings.saleType?(r=Math.round(100*(n-t)/n))<=100&&(o=r+"%"):0<(r=n-t)&&(o=`<span class="money">${theme.Currency.formatMoney(r,settings.moneyFormat)}</span>`),o)&&(e.classList.add("text-sale"),i&&(i.innerHTML=window.themeVariables.strings.save.replace("{{ saved_amount }}",o)),c)&&c.removeAttribute("hidden")}}}();