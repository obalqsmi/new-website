window.theme=window.theme||{},theme.Collection=function(){function t(t){this.container=t,this.selectors={sortDropdown:"[data-sort-by]",filterDropdown:"[data-filter-by]",gridButton:"[data-layout-button-grid]",listButton:"[data-layout-button-list]",gridItems:"[data-product-item-grid]",listItems:"[data-product-item-list]"},this.sectionSettings=theme.helpers.safelyParseJson(this.container.dataset.sectionSettings),this.init()}return t.prototype=Object.assign({},t.prototype,{init:function(){["grid","list"].includes(this.sectionSettings.layout)&&sessionStorage.setItem("collection-view",this.sectionSettings.layout),this.cacheSelectors(),this.setQueryParams(),this.filterCollection(),this.sortCollection(),this.showProductsBasedOnCurrentView(),this.gridViewEvent(),this.listViewEvent(),document.addEventListener("theme:addon:infinite-scroll:loaded",()=>{this.cacheSelectors(),this.showProductsBasedOnCurrentView()})},cacheSelectors:function(){this.cache={sortDropdown:this.container.querySelector(this.selectors.sortDropdown),filterDropdown:this.container.querySelector(this.selectors.filterDropdown),gridButton:this.container.querySelector(this.selectors.gridButton),listButton:this.container.querySelector(this.selectors.listButton),gridItems:this.container.querySelectorAll(this.selectors.gridItems),listItems:this.container.querySelectorAll(this.selectors.listItems)}},setQueryParams:function(){this.cache.sortDropdown&&(Shopify.queryParams=this.parseQueryString())},filterCollection:function(){this.cache.filterDropdown&&this.cache.filterDropdown.addEventListener("change",()=>{window.location.href=this.cache.filterDropdown.value})},sortCollection:function(){this.cache.sortDropdown&&this.cache.sortDropdown.addEventListener("change",()=>{Shopify.queryParams.page&&delete Shopify.queryParams.page,Shopify.queryParams.sort_by=this.cache.sortDropdown.value;var t=document.querySelectorAll(".dbtfy-collection-filters__form");t.length?(t.forEach(t=>{t=t.querySelector("[data-sort-by]");t&&(t.value=Shopify.queryParams.sort_by)}),location.search=new URLSearchParams(new FormData(t[0])).toString()):location.search=new URLSearchParams(Object.entries(Shopify.queryParams)).toString()})},showProductsBasedOnCurrentView:function(){var t=this.sectionSettings.layout,e=sessionStorage.getItem("collection-view");let i="list"===t||e&&"list"===e?!0:!1;i?this.listView():this.gridView()},listView:function(){sessionStorage.setItem("collection-view","list"),this.cache.gridButton?.classList.remove("btn--primary"),this.cache.listButton?.classList.add("btn--primary"),this.cache.gridItems.forEach(t=>{t.setAttribute("hidden","hidden")}),this.cache.listItems.forEach(t=>{t.removeAttribute("hidden")})},gridView:function(){sessionStorage.setItem("collection-view","grid"),this.cache.gridButton?.classList.add("btn--primary"),this.cache.listButton?.classList.remove("btn--primary"),this.cache.gridItems.forEach(t=>{t.removeAttribute("hidden")}),this.cache.listItems.forEach(t=>{t.setAttribute("hidden","hidden")})},gridViewEvent:function(){this.cache.gridButton?.addEventListener("click",()=>{this.gridView()})},listViewEvent:function(){this.cache.listButton?.addEventListener("click",()=>{this.listView()})},parseQueryString:function(){if(!location.search.length)return{};var s={};for(let t,e=0,i=location.search.substr(1).split("&");e<i.length;e++)1<(t=i[e].split("=")).length&&(s[decodeURIComponent(t[0])]=decodeURIComponent(t[1]));return s}}),t}();