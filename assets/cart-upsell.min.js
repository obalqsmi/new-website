!function(){const n={cartType:window.themeVariables.settings.cartType},s={addonSection:".dbtfy-cart-upsell",upsell:".dbtfy-cart-upsell-item",generalUpsell:".dbtfy-cart-upsell-item--general",specificUpsell:".dbtfy-cart-upsell-item--specific",form:".dbtfy-cart-upsell-item__form",image:".dbtfy-cart-upsell-item__image",variantsSelect:".dbtfy-cart-upsell-item__variants",button:".dbtfy-cart-upsell-item__button",quantity:".dbtfy-cart-upsell-item__quantity"},d={enabledAddon:"dbtfy-cart-upsell-enabled",addonSection:"dbtfy-cart-upsell",upsell:"dbtfy-cart-upsell-item",generalUpsell:"dbtfy-cart-upsell-item--general",replaceUpsell:"dbtfy-cart-upsell-item--replace"},o=(document.body.classList.add(d.enabledAddon),document.querySelector(s.addonSection));function t(e){if(e.items.length){document.querySelectorAll(".cart "+s.upsell).forEach(e=>{e.remove()}),a=e,(t=o.querySelectorAll(s.generalUpsell)).length&&a&&(t=Array.from(t).filter(e=>{if(e=theme.helpers.safelyParseJson(e.dataset.blockSettings)){const t=e.productId;return!a.items.some(e=>e.product_id===t)}})).length&&t.forEach(e=>{let t;"drawer"===n.cartType?t="#CartDrawer":"modal"===n.cartType&&(t="#CartModal");var r=document.querySelector(t+" .drawer__inner");if(r&&((a=(l=e.cloneNode(!0)).querySelector("form"))&&(a.removeAttribute("data-has-submit-event"),a.removeAttribute("data-has-submit-listener")),r.querySelector(s.generalUpsell)||r.insertAdjacentHTML("beforeend",`
            <div class="${d.addonSection} drawer__inner-section card-group"></div>
          `),a=r.querySelector(s.addonSection))&&a.insertAdjacentElement("beforeend",l),r=document.querySelector(".cart-page .cart__main")){var a=e.cloneNode(!0),l=a.querySelector("form");l&&(l.removeAttribute("data-has-submit-event"),l.removeAttribute("data-has-submit-listener"));const n=theme.helpers.safelyParseJson(e.dataset.blockSettings);n&&(l=n.productId,r.insertAdjacentHTML("beforeend",`
          <div class="${d.addonSection} mt-3" data-product-id="${l}"></div>
        `),e=r.querySelector(s.addonSection+`[data-product-id="${l}"]`))&&e.insertAdjacentElement("beforeend",a)}});var r=e;if((t=o.querySelectorAll(s.specificUpsell)).length&&r){const l=Array.from(t).filter(e=>{if(e=theme.helpers.safelyParseJson(e.dataset.blockSettings)){const t=e.productOfferId;return!r.items.some(e=>e.product_id===t)}});l.length&&r.items.forEach((e,o)=>{const t=e.product_id;if((e=l.filter(e=>{if(e=theme.helpers.safelyParseJson(e.dataset.blockSettings))return e=e.productTriggerId,t===e})).length){const r=[];e.filter(e=>{if(e=theme.helpers.safelyParseJson(e.dataset.blockSettings))return e=e.productOfferId,!r.includes(e)&&(r.push(e),!0)}).forEach(e=>{let t;"drawer"===n.cartType?t="#CartDrawer":"modal"===n.cartType&&(t="#CartModal");var r,a,l=document.querySelector(t+" .drawer__inner");l&&((r=(a=e.cloneNode(!0)).querySelector("form"))&&(r.removeAttribute("data-has-submit-event"),r.removeAttribute("data-has-submit-listener")),r=l.querySelector(`.cart__item[data-line="${o+1}"]`))&&(r.querySelector(s.specificUpsell)||r.insertAdjacentHTML("beforeend",`
                <div class="${d.addonSection} card-group mt-3" data-line="${o+1}"></div>
              `),r=l.querySelector(s.addonSection+`[data-line="${o+1}"]`))&&r.insertAdjacentElement("beforeend",a),(l=document.querySelector(".cart-page .cart__main"))&&((a=(r=e.cloneNode(!0)).querySelector("form"))&&(a.removeAttribute("data-has-submit-event"),a.removeAttribute("data-has-submit-listener")),e=l.querySelector(`.cart__row[data-line="${o+1}"]`))&&(e.querySelector(s.specificUpsell)||e.insertAdjacentHTML("beforeend",`
                <div class="${d.addonSection}" data-line="${o+1}"></div>
              `),a=l.querySelector(s.addonSection+`[data-line="${o+1}"]`))&&a.insertAdjacentElement("beforeend",r)})}})}document.querySelectorAll(s.variantsSelect).forEach(a=>{a.addEventListener("change",()=>{(t=(t=(t=(e=a).selectedOptions[0])&&theme.helpers.safelyParseJson(t.dataset.blockSettings))&&t.imageSrc)&&(e=e.closest(s.upsell).querySelector(s.image))&&(e.setAttribute("src",t),e.setAttribute("srcset",t));var e=a,t=e.selectedOptions[0];if(t=t&&theme.helpers.safelyParseJson(t.dataset.blockSettings)){const r=t.url;r&&e.closest(s.upsell).querySelectorAll("a").forEach(e=>{e.setAttribute("href",r)})}})}),document.querySelectorAll(s.button).forEach(n=>{n.addEventListener("click",e=>{e.preventDefault();var t,r,a,e=n.closest(s.upsell);const l=e.querySelector(s.form);let o=!1;e.classList.contains(d.replaceUpsell)&&(t=+(r=n.closest(".cart__row")).dataset.line,r=r.querySelector(".product-quantity__input"))&&(r=+r.value,a=e.querySelector(s.quantity),e=e.querySelector(s.variantsSelect)?.selectedOptions[0])&&(e=theme.helpers.safelyParseJson(e.dataset.blockSettings))&&r<=e.quantity&&(o=!0,a.value=r,theme.ShopifyAPI.changeItem(t,0,()=>{c(l,n)})),o||c(l,n)})}),theme.ajaxCart.init(),theme.imagesLazyLoading()}var a,t}function c(e,l){theme.loadingState.init(l),theme.ShopifyAPI.addItemFromForm({forms:e},e=>{var a;theme.loadingState.destroy(l),a=e,theme.ShopifyAPI.getCart(e=>{var t;t=e.item_count,document.querySelectorAll(".cart-link__bubble").forEach(e=>{e.textContent=t}),theme.ajaxCart.update();{var o=a;const r=document.querySelectorAll(s.upsell),n=document.querySelectorAll(".cart__row");r.forEach(e=>{const r=e.dataset.productId;if(r===o.product_id.toString()){let t=null;var a,l;n.forEach(e=>{e.dataset.productId===r&&(t=e)}),t&&((a=t.parentElement).insertBefore(e,t.nextSibling),(l=e.parentElement)!==a&&l.removeChild(e),e.classList.remove(d.upsell),e.classList.add("cart__row","cart__row--ajax"))}})}document.dispatchEvent(new CustomEvent("theme:cart:loaded",{detail:{cart:e}}))})},(e,t)=>{theme.loadingState.destroy(l);var r,e=JSON.parse(e.responseText);e.message&&422===e.status&&((r=l.nextElementSibling)&&r.remove(),l.insertAdjacentHTML("afterend",`<div class="errors product-quantity-error">${e.description}</div>`))})}o&&(theme.isCartLoaded?theme.helpers.loadComponents(["ajaxCart","imagesLazyloading","loadingState"],()=>{t(theme.cart)}):document.addEventListener("theme:cart:initially-loaded",e=>{theme.helpers.loadComponents(["ajaxCart","imagesLazyloading","loadingState"],()=>{t(theme.cart)})}),document.addEventListener("theme:cart:loaded",e=>{theme.helpers.loadComponents(["ajaxCart","imagesLazyloading","loadingState"],()=>{t(e.detail.cart)})}))}();