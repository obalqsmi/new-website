!function(){var e={strings:window.themeVariables.strings,settings:window.themeVariables.settings};const $={cartType:e.settings.cartType,moneyFormat:window.themeVariables.settings.moneyFormat,closeText:e.strings.close,icon:e.settings.icon},a={addonSection:".dbtfy-upsell-popup",upsellItem:".dbtfy-upsell-popup__item",upsellModal:".dbtfy-upsell-popup__modal"},T={enabledAddon:"dbtfy-upsell-popup-enabled",acceptedOffer:"dbtfy-upsell-popup__modal--offer-accepted"},C=document.querySelector(a.addonSection);function t(){theme.isCartLoaded?(d(),o(()=>{s()})):document.addEventListener("theme:cart:initially-loaded",e=>{d(),o(()=>{s()})})}function d(){var e=C.querySelectorAll(a.upsellModal);const t=C.querySelectorAll(a.upsellItem);e.forEach(e=>{e.remove()}),t.length&&(e=Array.from(t).map(e=>{var t,a,e=theme.helpers.safelyParseJson(e.dataset.blockSettings);if(e)return t=e.productTrigger,e=e.productOffer,a=[],t&&a.push(t),e&&a.push(e),a}).flat(),e=[...new Set(e)].map(e=>"handle:"+e).join(" OR "),fetch("/search?view=product-info&type=product&q="+e,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.text()).then(e=>{if(e){const _=theme.helpers.safelyParseJson(e);_&&(e=Array.from(t).map((t,a)=>{t=theme.helpers.safelyParseJson(t.dataset.blockSettings);if(t){var d=t.heading,o=t.text,i=t.collectionTrigger;const b=t.productTrigger,v=t.productOffer;var n=t.buttonLabel,r=t.buttonIcon,l=t.discountName,c=t.discountAmount,u=t.discountType,t=t.blockId,p=_.find(e=>e.handle===b);const y=_.find(e=>e.handle===v);var m=y&&y.available;if(!y||!m)return null;let e;e=b||i?i&&!p?i:p?p.id:"":"general";m=theme.cart.items&&theme.cart.items.some(e=>e.handle===v);let s=0;p=document.getElementById("upsellProductOfferJson-"+y.id);const g=p&&JSON.parse(p.innerHTML);var p=y.variants.map(t=>{if(s++,t.available){let e;var a=(e=t.featured_image||(y.featured_image.src?y.featured_image:g&&g.media.preview_image))&&e.aspect_ratio?e.aspect_ratio:1,d=e?e.alt:null,d=`<img src="${e?e.src:null}" alt="${d}" class="media">`,o=window.themeVariables.variables.productPlaceholderSvg;return`
                <div class="media-wrapper media-wrapper--product dbtfy-upsell-product__image"
                     data-variant-id="${t.id}"
                     ${1!==s?"hidden":""}
                     style="padding-top: ${e?0!==a?1/a*100:1:0}%${e?"":"!important"};">

                  ${e?d:o}
                </div>
              `}return s--,""}).join(""),h=y.variants.map(e=>e.available?`
                <option value="${e.id}" data-variant-title="${e.title}" data-variant-price="${e.price}">
                  ${e.title} - ${theme.Currency.formatMoney(e.price,$.moneyFormat)}
                </option>
              `:`
              <option disabled="disabled" hidden>
                ${e.title} - ${window.themeVariables.strings.soldOutButton}
              </option>
            `).join(""),t=y.description||$.descriptionTabHeading?`
            <div class="card tab">
              <button id="tab-button-${t}" class="card__header tab__header"
                      type="button"
                      role="tab"
                      aria-controls="tab-content-${t}"
                      aria-selected="false">
                <span class="tab__header-title">${$.descriptionTabHeading}</span>
              </button>

              <div id="tab-content-${t}" class="card__body tab__body" role="tabpanel" aria-labelledby="tab-button-${t}">
                <div class="tab__content rte">
                  ${y.description.replace("<p>[split_description]</p>","").replace("[split_description]","")}
                </div>
              </div>
            </div>
          `:"",f=$.declineOfferText||$.goToCheckoutText?`
            <div class="modal__footer">
              <div class="row">
                <div class="col-6">
                  ${$.declineOfferText?`
                    <button type="button" class="text-sm"
                            data-modal-close="#UpsellPopup-${e}-${a}">
                      ${$.declineOfferText}
                    </button>
                  `:""}
                </div>

                <div class="col-6 d-flex justify-content-end">
                  ${$.goToCheckoutText?`
                    <button type="button" class="dbtfy-upsell-popup__checkout-link text-sm text-center">
                      <div class="btn__text">
                        ${$.goToCheckoutText}
                      </div> 
                    </button>
                  `:""}
                </div>
              </div>
            </div>
          `:"";return`
            <div id="UpsellPopup-${e}-${a}"
                 class="modal modal--${$.width} dbtfy-upsell-popup__modal${m?" "+T.acceptedOffer:""}"
                 role="dialog"
                 data-product-offer="${y.id}"
                 data-product-trigger-id="${e}"
                 data-collection-trigger="${i}"
                 ${l&&u&&c?`
                   data-discount-name="${l}"
                   data-discount-type="${u}"
                   data-discount-amount="${c}"
                 `:""}>

              <div class="modal__dialog">
                <div class="overlay-content modal__content" aria-hidden="true" tabindex="-1">
                  <div class="modal__header">
                    <h4 class="modal__title h4">
                      <a href="${y.url}">${y.title}</a>
                    </h4>

                    <button type="button"
                            class="modal__close btn btn--square-sm"
                            title="${$.close}"
                            aria-label="${$.close}"
                            data-modal-close="#UpsellPopup-${e}-${a}">
                      <span class="${$.icon}" translate="no" aria-hidden="true">close</span>
                    </button>
                  </div>

                  <div class="progress">
                    <div class="progress__bar dbtfy-upsell-popup__progress-bar"
                         role="progressbar"
                         style="width: ${$.progressBarWidth}%;">
                    </div>
                  </div>

                  <div class="modal__body">
                    <div class="row row--sm align-items-center">
                      <div class="col-md-6">
                        ${p}
                      </div>

                      <div class="col-md-6 ${$.textAlignment}">
                        <div class="rte mt-3 mt-md-0">
                          ${d?`<h3>${d}</h3>`:""}
                          ${o||""}
                        </div>

                        <form method="post" action="/cart/add" class="dbtfy-upsell-product__form mt-3" enctype="multipart/form-data">
                          <input type="hidden" name="form_type" value="product">
                          <input type="hidden" name="utf8" value="âœ“">

                          <select name="id" class="dbtfy-upsell-product__select select select--sm select--full" ${y.variants.length<=1?"hidden":""}>
                            ${h}
                          </select>

                          ${n?`
                            <button type="submit" class="btn btn--primary btn--full dbtfy-upsell-product__btn-offer mt-3">
                              <div class="btn__text">
                                ${r?`
                                  <span class="${$.icon}" translate="no" aria-hidden="true">
                                      ${r}
                                  </span>
                              `:""}

                                ${n}
                              </div>
                            </button>
                          `:""}
                        </form>
                      </div>
                    </div>
                  </div>

                  ${t}

                  ${f}
                </div>
              </div>
            </div>

            <div class="overlay-modal overlay-backdrop"></div>
          `}}).join(""),C.insertAdjacentHTML("afterbegin",e),theme.helpers.loadComponent("handleExternalLinks",()=>{theme.handleExternalLinks()}),document.dispatchEvent(new CustomEvent("theme:addon:upsell-popup:markup-loaded")))}}))}function o(e){document.addEventListener("theme:addon:upsell-popup:markup-loaded",()=>{theme.helpers.styleTextLinks(),theme.helpers.loadComponents(["tabs","modal","discountCode","loadingState","ajaxCart","goToCheckout"],()=>{theme.Tabs.init(),theme.Modal.init(),theme.discountCode.init(),theme.loadingState.initForm(),theme.ajaxCart.init(),e()})})}function s(){const v=C.querySelector(".dbtfy-upsell-popup__modal[data-product-trigger-id='general']"),e=C.querySelectorAll(a.upsellItem),y=document.querySelectorAll("form[action*='/cart/add']");function o(e,a,d){var o=e.closest("[data-product-id]");if(o){const i=+o.dataset.productId;let t=C.querySelector(`.dbtfy-upsell-popup__modal[data-product-trigger-id='${i}']`);o=o.dataset.productCollections,o=o&&o.split(","),o=o&&o.map(e=>C.querySelector(`.dbtfy-upsell-popup__modal[data-product-trigger-id='${e}']`)).filter(e=>e);if((e.hasAttribute("data-has-submit-listener")||!d)&&!e.classList.contains("dbtfy-upsell-product__form")){if(t)a&&a.preventDefault();else if(o&&o.length)a&&a.preventDefault(),t=o[0];else{if(!v)return void g(e,!d);a&&a.preventDefault(),t=v}const n=t.querySelectorAll(".dbtfy-upsell-product__image"),r=t.querySelector(".dbtfy-upsell-product__select"),l=t.querySelector(".dbtfy-upsell-product__form");var s,o=t.querySelector(".dbtfy-upsell-product__btn-offer");const c=t.querySelector(".dbtfy-upsell-popup__progress-bar"),u=t.querySelector(".dbtfy-upsell-popup__checkout-link"),p=t.dataset.productOffer,m=t.dataset.discountName,h=t.dataset.discountType,f=t.dataset.discountAmount,b=Boolean(i==+p);theme.cart.items.some(e=>e.product_id===+p&&!b)||t.classList.contains(T.acceptedOffer)?g(e,!d):(o&&o.addEventListener("click",()=>{e.removeAttribute("data-has-submit-listener"),t.classList.add(T.acceptedOffer),m&&h&&f&&theme.discountCode.addDiscount(m,h,f,{productTriggerId:i,productOfferId:+p,role:"upsell-popup"}),c&&(c.style.width="100%"),theme.ShopifyAPI.addItemFromForm({forms:l},e=>{theme.Modal.close(t),document.body.classList.contains("dbtfy-cart-notification-enabled")&&window.initNotificationToast||(document.dispatchEvent(new CustomEvent("theme:addon:upsell-popup:loaded")),setTimeout(()=>{c&&(c.style.width="75%")},2e3),document.body.classList.contains("dbtfy-skip-cart-enabled")&&theme.goToCheckoutWithDiscount())},(e,t,a)=>{})}),d?(s=t,theme.ShopifyAPI.addItemFromForm({forms:e},e=>{theme.helpers.loadComponent("modal",()=>{theme.Modal.open(s)})},(e,t,a)=>{document.dispatchEvent(new CustomEvent("theme:cart:loading-error",{detail:{form:a,textStatus:t}}))})):theme.helpers.loadComponent("modal",()=>{theme.Modal.open(t)}),t.hasAttribute("data-has-upsell-listener")||(t.addEventListener("modal.close",()=>{document.body.classList.contains("dbtfy-skip-cart-enabled")?theme.goToCheckoutWithDiscount():"page"===$.cartType?document.body.classList.contains("template-cart")||window.location.assign("/cart"):"drawer"===$.cartType?(theme.ajaxCart.update(),document.addEventListener("theme:cart:loaded",e=>{y.forEach(e=>{e.setAttribute("data-has-submit-listener","true")})})):(theme.ajaxCart.update(),document.addEventListener("theme:cart:loaded",e=>{document.body.classList.contains("dbtfy-cart-notification-enabled")&&window.initNotificationToast||theme.helpers.loadComponent("cartModal",()=>{theme.CartModal.init()})}))}),t.setAttribute("data-has-upsell-listener","true")),u&&u.addEventListener("click",()=>{theme.loadingState.init(u),theme.ajaxCart.update(()=>{theme.goToCheckoutWithDiscount()})}),r&&r.addEventListener("change",()=>{var e=r.value,e=t.querySelector(`.dbtfy-upsell-product__image[data-variant-id='${e}']`);n.forEach(e=>{e.setAttribute("hidden","hidden")}),e&&e.removeAttribute("hidden")}))}}}function g(e,t){e.removeAttribute("data-has-submit-listener"),t?theme.ajaxCart.update():e.dispatchEvent(new CustomEvent("form-submit")),e.setAttribute("data-has-submit-listener","true")}y.forEach(t=>{if(v)t.setAttribute("data-has-submit-listener","true");else{const a=+t.closest("[data-product-id]")?.dataset.productId,d=t.closest("[data-product-id]")?.dataset.productCollections?.split(",");Array.from(e).some(e=>{e=theme.helpers.safelyParseJson(e.dataset.blockSettings);if(e)return a===e.productTriggerId||e.collectionTrigger&&d?.includes(e.collectionTrigger)})&&t.setAttribute("data-has-submit-listener","true")}t.addEventListener("submit",e=>{theme.isCartLoaded?o(t,e,!0):document.addEventListener("theme:cart:initially-loaded",e=>{o(t,e,!0)})})}),document.addEventListener("theme:addon:upsell-popup:form-submitted",e=>{e=e.detail.form;e&&o(e,null,!1)})}C&&(e=theme.helpers.safelyParseJson(C.dataset.sectionSettings))&&(document.body.classList.add(T.enabledAddon),$.width=e.width,$.descriptionTabHeading=e.descriptionTabHeading,$.declineOfferText=e.declineOfferText,$.goToCheckoutText=e.goToCheckoutText,$.textAlignment=e.textAlignment,$.progressBarWidth=e.progressBarWidth,t(),document.addEventListener("theme:addon:collection-filters:loaded",()=>{t()}),document.addEventListener("theme:addon:infinite-scroll:loaded",()=>{t()}),document.addEventListener("theme:addon:quick-view:loaded",()=>{t()}),document.addEventListener("theme:addon:wishlist:loaded",()=>{t()}),document.addEventListener("theme:cart:loaded",t=>{var o;theme.helpers.loadComponent("discountCode",()=>{var d,e;(d=t.detail.cart)&&(e=theme.discountCode.getStoredDiscounts()).length&&(e=e.filter(e=>!!e.hasOwnProperty("role")&&"upsell-popup"===e.role)).length&&(e.forEach(e=>{const t=e.productOfferId;var a=e.productTriggerId,a=Boolean(t===a);d.items.some(e=>e.product_id===t)||a||theme.discountCode.removeDiscount(e.name),theme.discountCode.init(d)}),document.dispatchEvent(new CustomEvent("theme:addon:upsell-popup:loaded")))}),(o=t.detail.cart)&&document.querySelectorAll(a.upsellModal).forEach(e=>{const t=+e.dataset.productOffer;var a=+e.dataset.productTriggerId,a=Boolean(t==a),d=o.items.some(e=>e.product_id===t);e.classList.contains(T.acceptedOffer)&&(a&&!d||!d)&&e.classList.remove(T.acceptedOffer),d||a||e.classList.remove(T.acceptedOffer)})}))}();