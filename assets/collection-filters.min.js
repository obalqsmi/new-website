!function(){const p={layout:{addon:window.themeVariables.settings.addons.collectionFilters}.addon.layout,searchParamsInitial:window.location.search.slice(1),searchParamsPrev:window.location.search.slice(1),filterData:[],dropdownIndexesToOpen:[]},f={addonSection:".dbtfy-collection-filters",actionsRow:".collection-template__actions-row",filtersDrawer:".dbtfy-collection-filters-drawer",filtersVertical:".dbtfy-collection-filters-vertical",filtersHorizontal:".dbtfy-collection-filters-horizontal",form:".dbtfy-collection-filters__form",checkbox:".dbtfy-collection-filters__checkbox",removeFilter:".dbtfy-collection-filters__remove"},o={enabledAddon:"dbtfy-collection-filters-enabled",checkbox:"dbtfy-collection-filters-drawer__checkbox"};document.body.classList.add(o.enabledAddon);var e=document.querySelector(f.actionsRow);(e&&e.removeAttribute("hidden"),"vertical"===p.layout)?(e=document.querySelector(f.filtersVertical))&&(h(e),y(e),v(e)):"horizontal"===p.layout&&(theme.helpers.loadComponent("dropdown",()=>{var e=document.querySelector(f.filtersHorizontal);e&&theme.Dropdown(e)}),e=document.querySelector(f.filtersHorizontal))&&(h(e),y(e),v(e));function h(e){e&&e.querySelectorAll(`.dbtfy-collection-filters-horizontal .dbtfy-collection-filters__section ${f.removeFilter}, .dbtfy-collection-filters-vertical__section .dbtfy-collection-filters__section ${f.removeFilter}, .dbtfy-collection-filters__section `+f.removeFilter).forEach(e=>{var t=e.dataset.filterName,n=new URLSearchParams(window.location.href);n.delete(t),e.href=decodeURIComponent(n.toString())})}function v(e){if(e){const n=e.querySelector(f.form);function r(e,t,n,r=!0){p.searchParamsPrev=e;var o=document.querySelector(".collection-template").dataset.sectionId;const l=window.location.pathname+`?section_id=${o}&`+e;var a,i,o=e=>e.url===l;if("horizontal"===p.layout&&(c=document.querySelector(f.filtersHorizontal))&&(p.dropdownIndexesToOpen=Array.from(c.querySelectorAll(".dropdown")).map((e,t)=>{if(e.classList.contains("dropdown--open"))return t}).filter(e=>Number.isInteger(e))),p.filterData.some(o)){var c=o,s=t;if(d(c=p.filterData.find(c).html,s),u(c),theme.helpers.loadComponent("imagesLazyloading",()=>{theme.imagesLazyLoading()}),h(s),v(s),y(s),m(s),new theme.Drawer("CollectionFiltersDrawer","left",{isOpened:!0}),"drawer"!==p.layout){const s=document.querySelector(f.filtersDrawer);d(c,s),h(s),v(s),y(s),m(s)}"horizontal"===p.layout&&theme.helpers.loadComponent("dropdown",()=>{const t=document.querySelector(f.filtersHorizontal);t&&(theme.Dropdown(t),p.dropdownIndexesToOpen.forEach(e=>{e=t.querySelectorAll(".dropdown")[e];e&&e.dispatchEvent(new CustomEvent("theme:component:dropdown:show"))}),p.dropdownIndexesToOpen=[])}),document.dispatchEvent(new CustomEvent("theme:addon:collection-filters:loaded"))}else a=l,i=t,fetch(a).then(e=>e.text()).then(e=>{if(p.filterData=[...p.filterData,{html:e,url:a}],d(e,i),u(e),theme.helpers.loadComponent("imagesLazyloading",()=>{theme.imagesLazyLoading()}),h(i),v(i),y(i),m(i),new theme.Drawer("CollectionFiltersDrawer","left",{isOpened:!0}),"drawer"!==p.layout){const i=document.querySelector(f.filtersDrawer);d(e,i),h(i),v(i),y(i),m(i)}if("horizontal"===p.layout){const t=document.querySelector(f.filtersHorizontal);if(!t)return;theme.helpers.loadComponent("dropdown",()=>{theme.Dropdown(t),p.dropdownIndexesToOpen.forEach(e=>{e=t.querySelectorAll(".dropdown")[e];e&&e.dispatchEvent(new CustomEvent("theme:component:dropdown:show"))}),p.dropdownIndexesToOpen=[]})}document.dispatchEvent(new CustomEvent("theme:addon:collection-filters:loaded"))});r&&(o=e,history.pushState({searchParams:o},"",""+window.location.pathname+(o&&"?".concat(o))))}function d(e,t){var n;t&&(e=(new DOMParser).parseFromString(e,"text/html"),t.classList.contains("dbtfy-collection-filters-vertical")?(n=e.querySelector(f.filtersVertical))&&(t.innerHTML=n.innerHTML):t.classList.contains("dbtfy-collection-filters-horizontal")?(n=e.querySelector(f.filtersHorizontal))&&(t.innerHTML=n.innerHTML):t.classList.contains("dbtfy-collection-filters-drawer")&&(n=e.querySelector(f.filtersDrawer))&&(t.classList.add("drawer--no-inner-animation"),t.innerHTML=n.innerHTML))}function u(e){document.querySelector(".collection-template__products").innerHTML=(new DOMParser).parseFromString(e,"text/html").querySelector(".collection-template__products").innerHTML}function m(n){n&&n.querySelectorAll(f.removeFilter).forEach(e=>{e.addEventListener("click",e=>{var t;e.preventDefault(),t=n,(e=e).preventDefault(),r(-1===e.currentTarget.href.indexOf("?")?"":e.currentTarget.href.slice(e.currentTarget.href.indexOf("?")+1),t)})})}n.addEventListener("input",theme.helpers.debounce(e=>{var t=n.closest(".dbtfy-collection-filters")||n.closest(".dbtfy-collection-filters-vertical")||n.closest(".dbtfy-collection-filters-horizontal");t=t,(e=e).preventDefault(),e.target.className!==o.checkbox&&!e.target.closest("form")||r(function(e){e=new FormData(e);return new URLSearchParams(e).toString()}(e.target.closest("form")),t)},500)),m(e)}}function y(e){if(e){const l=e.querySelector(f.form);e.querySelectorAll(".price-range").forEach(e=>{const t=e.querySelector("input[type='range']:first-child"),n=e.querySelector("input[type='range']:last-child"),r=e.querySelector("input[name='filter.v.price.gte']"),o=e.querySelector("input[name='filter.v.price.lte']");r.addEventListener("change",e=>{e.preventDefault(),r.value=Math.max(Math.min(parseInt(r.value),parseInt(o.value||r.max)-1),r.min),t.value=r.value,t.parentElement.style.setProperty("--range-min",parseInt(t.value)/parseInt(t.max)*100+"%"),l.dispatchEvent(new Event("input"))}),o.addEventListener("change",e=>{e.preventDefault(),o.value=Math.min(Math.max(parseInt(o.value),parseInt(r.value||o.min)+1),o.max),n.value=o.value,n.parentElement.style.setProperty("--range-max",parseInt(n.value)/parseInt(n.max)*100+"%"),l.dispatchEvent(new Event("input"))}),t.addEventListener("change",e=>{e.stopPropagation(),r.value=t.value,r.dispatchEvent(new Event("change",{bubbles:!0})),l.dispatchEvent(new Event("input"))}),n.addEventListener("change",e=>{e.stopPropagation(),o.value=n.value,o.dispatchEvent(new Event("change",{bubbles:!0})),l.dispatchEvent(new Event("input"))}),t.addEventListener("input",e=>{t.value=Math.min(parseInt(t.value),parseInt(o.value||t.max)-1),t.parentElement.style.setProperty("--range-min",parseInt(t.value)/parseInt(t.max)*100+"%"),r.value=t.value,l.dispatchEvent(new Event("input"))}),n.addEventListener("input",e=>{n.value=Math.max(parseInt(n.value),parseInt(r.value||n.min)+1),n.parentElement.style.setProperty("--range-max",parseInt(n.value)/parseInt(n.max)*100+"%"),o.value=n.value,l.dispatchEvent(new Event("input"))})})}}theme.helpers.loadComponent("drawer",()=>{var e,t;(e=document.querySelector(f.filtersDrawer))&&(new theme.Drawer("CollectionFiltersDrawer","left"),t=e.nextElementSibling,document.body.insertAdjacentElement("beforeend",e),document.body.insertAdjacentElement("beforeend",t),h(e),y(e),v(e))})}();