window.theme=window.theme||{},theme.ajaxCart=function(){let init,loadCart,updateCart,settings,isUpdating,isLoaded=!1,cartDrawer,cartModal,cartContainer,cartPageContainer,formContainer,addToCart,cartCountSelector,cartCostSelector,quantityAdjust,quantityInput,quantityRemove,checkoutSelector,cartNoteSelector,isCartPage,defaultShopLocale,isDefaultShopLocaleSet,updateCountPrice,formOverride,formSubmitHandler,itemAddedCallback,itemErrorCallback,cartUpdateCallback,buildCart,cartCallback,adjustCart,adjustCartCallback,buildCartPage,validateQty,getCartDrawerMarkup,getCartPageMarkup;return init=function(t){settings={cartDrawer:"#CartDrawer",cartModal:"#CartModal",cartContainer:"#CartContainer",cartPageContainer:".cart-page",formSelector:"form[action*='/cart/add'], form[action*='javascript']",addToCartSelector:"input[type='submit'], button[type='submit']",checkoutSelector:"button[name='checkout']",cartCountSelector:".cart-count",cartCostSelector:".cart-cost",moneyFormat:window.themeVariables.settings.moneyFormat,disableAjaxCart:!1,drawerIsLoadingClass:"cart--is-loading",drawerIsLoadedClass:"cart--is-loaded",ajaxCartIsUpdating:"cart-drawer--is-updating",quantityErrorClass:"product-quantity-error",ajaxCartTemplateName:"cart",ajaxCartAltTemplateName:"ajax",ajaxCartPageAltTemplateName:"ajax-page",quantityAdjustSelector:".product-quantity__button",quantityInputSelector:".product-quantity__input",quantityAddSelector:".product-quantity__button--plus",quantityAddClass:"product-quantity__button--plus",quantityRemoveSelector:".js-cart-product-remove",cartNoteSelector:"textarea[name='note']",cartProductSelector:".cart__item",isLoadingClass:"is-loading"},"object"==typeof t&&(settings={...settings,...t}),cartDrawer=document.querySelector(settings.cartDrawer),cartModal=document.querySelector(settings.cartModal),cartContainer=document.querySelector(settings.cartContainer),cartPageContainer=document.querySelector(settings.cartPageContainer),formContainer=document.querySelectorAll(settings.formSelector),checkoutSelector=document.querySelectorAll(settings.checkoutSelector),cartCountSelector=document.querySelectorAll(settings.cartCountSelector),cartCostSelector=document.querySelectorAll(settings.cartCostSelector),addToCart=Array.from(formContainer).map(t=>Array.from(t.querySelectorAll(settings.addToCartSelector))).flat(),isCartPage=document.body.classList.contains("template-cart"),window.colorScheme&&window.sectionId&&(localStorage.setItem("colorScheme",window.colorScheme),localStorage.setItem("sectionId",window.sectionId)),document.body.classList.contains("dbtfy-cart-notification-enabled")&&(window.initNotificationToast=!0),!settings.disableAjaxCart&&addToCart.length&&formOverride(),document.addEventListener("theme:cart:form-override:init",()=>{formOverride()}),theme.helpers.loadComponent("cartModal",()=>{theme.CartModal.initCartIconClick(cartUpdateCallback)}),adjustCart(),(defaultShopLocale=window.themeVariables.variables.shop.publishedLocales.find(t=>t.shop_locale.primary))&&Shopify.locale===defaultShopLocale.shop_locale.locale&&(isDefaultShopLocaleSet=!0)},loadCart=function(){var t;isLoaded||(t=window.themeVariables.settings.cartType,theme.cart?"drawer"===t?cartDrawer.classList.contains(settings.drawerIsLoadingClass)&&cartUpdateCallback(theme.cart):"modal"===t&&cartModal.classList.contains(settings.drawerIsLoadingClass)&&cartUpdateCallback(theme.cart):document.addEventListener("theme:cart:initially-loaded",()=>{window.initNotificationToast=!1,cartUpdateCallback(theme.cart)}))},updateCart=function(e){"function"==typeof e?theme.ShopifyAPI.getCart(t=>{cartUpdateCallback(t,e)}):theme.ShopifyAPI.getCart(cartUpdateCallback)},updateCountPrice=function(t){const e=t&&t.item_count?t.item_count:0,a=t&&t.total_price?t.total_price:0;cartCountSelector.forEach(t=>{t.innerText=e<=99?e:"99+"}),cartCostSelector.forEach(t=>{t.innerHTML=`<span class="money">${theme.Currency.formatMoney(a,settings.moneyFormat)}</span>`})},formOverride=function(){(formContainer=document.querySelectorAll(settings.formSelector)).forEach(e=>{e.hasAttribute("data-has-submit-event")||(e.addEventListener("submit",t=>{formSubmitHandler(e,t)}),e.addEventListener("form-submit",()=>{formSubmitHandler(e)})),e.setAttribute("data-has-submit-event","true")})},formSubmitHandler=function(t,e){e&&e.preventDefault(),t.hasAttribute("data-has-submit-listener")||(document.querySelectorAll("."+settings.quantityErrorClass).forEach(t=>{t.remove()}),theme.ShopifyAPI.addItemFromForm({forms:t},itemAddedCallback,itemErrorCallback))},itemAddedCallback=function(){document.body.classList.contains("dbtfy-skip-cart-enabled")?theme.helpers.loadComponent("goToCheckout",()=>{theme.goToCheckoutWithDiscount()}):"drawer"===window.themeVariables.settings.cartType||"modal"===window.themeVariables.settings.cartType?(document.body.classList.contains("dbtfy-cart-notification-enabled")&&(window.initNotificationToast=!0),theme.ShopifyAPI.getCart(cartUpdateCallback)):document.body.classList.contains("template-cart")?theme.ShopifyAPI.getCart(cartUpdateCallback):document.body.classList.contains("dbtfy-cart-notification-enabled")?(theme.ShopifyAPI.getCart(cartUpdateCallback),theme.helpers.loadComponent("notificationToast",()=>{theme.NotificationToast.init(".dbtfy-cart-notification")})):window.location.assign("/cart")},itemErrorCallback=function(XMLHttpRequest,textStatus,form){const data=eval(`(${XMLHttpRequest.responseText||"{}"})`);if(theme.helpers.loadComponent("loadingState",()=>{theme.loadingState.destroy(addToCart)}),document.dispatchEvent(new CustomEvent("theme:cart:loading-error",{detail:{form:form,textStatus:textStatus}})),data.message&&422===data.status){let formToInsert=formContainer;form&&(formToInsert=form),Array.from(formToInsert).forEach(t=>{var e=t.nextElementSibling;e&&!e.classList.contains(settings.quantityErrorClass)&&t.insertAdjacentHTML("afterend",`<div class="errors product-quantity-error">${data.description}</div>`)}),theme.ShopifyAPI.onError(data)}},cartUpdateCallback=async function(e,a){isLoaded=isLoaded||!0,document.dispatchEvent(new CustomEvent("theme:cart:loading")),theme.cart=e,Promise.all([buildCart(e),buildCartPage(e)]).then(t=>{"function"==typeof a&&a(e)})},buildCart=async function(t){cartDrawer&&cartDrawer.classList.add(settings.ajaxCartIsUpdating),cartModal&&cartModal.classList.add(settings.ajaxCartIsUpdating);var e=await getCartDrawerMarkup();if(cartContainer){for(;cartContainer.firstChild;)cartContainer.removeChild(cartContainer.firstChild);cartContainer.insertAdjacentHTML("afterbegin",e)}cartCallback(t,"drawer")},cartCallback=function(t,e){updateCountPrice(t),theme.helpers.loadComponent("discountCode",()=>{theme.discountCode.init()}),0===t.item_count&&sessionStorage.removeItem("discount"),adjustCart();var a=window.themeVariables.settings.cartType;"drawer"===a?(cartDrawer.classList.remove(settings.drawerIsLoadingClass),cartDrawer.classList.remove(settings.ajaxCartIsUpdating),cartDrawer.classList.add(settings.drawerIsLoadedClass)):"modal"===a&&(cartModal.classList.remove(settings.drawerIsLoadingClass),cartModal.classList.remove(settings.ajaxCartIsUpdating),cartModal.classList.add(settings.drawerIsLoadedClass)),theme.helpers.styleTextLinks(),theme.helpers.loadComponent("imagesLazyloading",()=>{theme.imagesLazyLoading()}),theme.helpers.loadComponent("loadingState",()=>{theme.loadingState.destroy(addToCart)}),window.Shopify&&window.Shopify.StorefrontExpressButtons&&!window.Shopify.designMode&&Shopify.StorefrontExpressButtons.initialize(),"drawer"===a?(theme.RightDrawer.init(),isCartPage||(window.initNotificationToast&&document.body.classList.contains("dbtfy-cart-notification-enabled")?theme.helpers.loadComponent("notificationToast",()=>{theme.NotificationToast.init(".dbtfy-cart-notification")}):theme.RightDrawer.open(),theme.helpers.trapFocus({container:cartDrawer}))):"modal"!==a||isCartPage||(window.initNotificationToast&&document.body.classList.contains("dbtfy-cart-notification-enabled")?theme.helpers.loadComponent("notificationToast",()=>{theme.NotificationToast.init(".dbtfy-cart-notification")}):(theme.helpers.loadComponent("modal",()=>{theme.Modal.init()}),theme.helpers.loadComponent("cartModal",()=>{theme.CartModal.init()}))),isUpdating=!1,theme.cart=t,document.dispatchEvent(new CustomEvent("theme:cart:loaded",{detail:{cart:t,cartType:e}}))},adjustCart=function(){function n(t,e){isUpdating=!0;var a=document.querySelector(settings.cartProductSelector+`[data-line="${t}"]`);a&&a.classList.add(settings.isLoadingClass),theme.ShopifyAPI.changeItem(t,e,t=>{document.body.classList.contains("dbtfy-cart-notification-enabled")&&(window.initNotificationToast=!1),adjustCartCallback(t)})}quantityAdjust=document.querySelectorAll(settings.quantityAdjustSelector),quantityInput=document.querySelectorAll(settings.quantityInputSelector),quantityRemove=document.querySelectorAll(settings.quantityRemoveSelector),checkoutSelector=document.querySelectorAll(settings.checkoutSelector),cartNoteSelector=document.querySelectorAll(settings.cartNoteSelector),quantityAdjust.forEach(o=>{o.hasAttribute("data-qty-listener")||(o.setAttribute("data-qty-listener","true"),o.addEventListener("click",()=>{if(!isUpdating){var e=o.closest(settings.cartProductSelector),a=e||o.closest(".product-quantity"),r=a.dataset.line,a=a.querySelector(settings.quantityInputSelector);o.closest(".cart__row--ajax");let t=parseInt(a.value.replace(/\D/g,""));t=validateQty(t),o.classList.contains(settings.quantityAddClass)?t+=1:--t<=0&&(t=r?0:1),r?(isCartPage,n(r,t)):(a.value=t,a.dispatchEvent(new Event("change"))),(e||isCartPage)&&theme.helpers.loadComponent("loadingState",()=>{theme.loadingState.init(o)})}}))}),quantityInput.forEach(a=>{a.addEventListener("change",()=>{var t,e;isUpdating||(t=(e=a.closest(settings.cartProductSelector)||a.closest(".product-quantity")).dataset.line,e=e.querySelector(settings.quantityInputSelector),a.closest(".cart__row--ajax"),e=e?parseInt(e.value.replace(/\D/g,"")):null,e=validateQty(e),t&&(isCartPage,n(t,e)))})}),quantityRemove.forEach(e=>{e.addEventListener("click",t=>{isUpdating||(t.preventDefault(),t=e.closest(settings.cartProductSelector).dataset.line,e.closest(".cart-row__ajax"),t&&(isCartPage,n(t,0)),theme.helpers.loadComponent("loadingState",()=>{theme.loadingState.init(e)}))})}),checkoutSelector.forEach(e=>{e.addEventListener("click",t=>{isUpdating?t.preventDefault():theme.helpers.loadComponent("loadingState",()=>{theme.loadingState.init(e)})})}),cartNoteSelector.forEach(e=>{e.addEventListener("change",()=>{var t=e.value;theme.ShopifyAPI.updateCartNote(t)})})},adjustCartCallback=function(t){theme.cart=t,setTimeout(()=>{buildCart(t),buildCartPage(t),isUpdating=!1},150)},buildCartPage=async function(t){if(!document.body.classList.contains("template-cart"))return!0;for(var e=await getCartPageMarkup();cartPageContainer.firstChild;)cartPageContainer.removeChild(cartPageContainer.firstChild);cartPageContainer.insertAdjacentHTML("afterbegin",e);var e=cartPageContainer.firstElementChild,a=localStorage.getItem("colorScheme"),r=localStorage.getItem("sectionId");e&&a&&r&&(e.setAttribute("data-color-scheme",a),e.setAttribute("data-section-id",r),e.className=`section cart cart-page color-${a} color-text`),cartCallback(t,"page")},validateQty=function(t){return parseFloat(t)!==parseInt(t)||isNaN(t)?1:t},getCartDrawerMarkup=async function(){let t;return t=isDefaultShopLocaleSet||"/"===Shopify.routes.root?settings.ajaxCartTemplateName:""+Shopify.routes.root+settings.ajaxCartTemplateName,theme.helpers.fetchTemplate({template:t,alternativeTemplate:settings.ajaxCartAltTemplateName})},getCartPageMarkup=async function(){let t;return t=isDefaultShopLocaleSet||"/"===Shopify.routes.root?settings.ajaxCartTemplateName:""+Shopify.routes.root+settings.ajaxCartTemplateName,theme.helpers.fetchTemplate({template:t,alternativeTemplate:settings.ajaxCartPageAltTemplateName})},{init:init,load:loadCart,update:updateCart}}();